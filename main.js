(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-37",headers:{authorization:"834735c1-0023-486e-9cd7-15b9f35fd60d","Content-Type":"application/json"}};function t(e,t){t.textContent=e?"Сохраняется...":"Cохранить"}var n=document.querySelector("#card-template").content,o=function(t,n){!function(t){fetch("".concat(e.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:e.headers}).catch((function(e){return Promise.reject("Ошибка: ".concat(res.status))}))}(n),t.target.closest(".card").remove()},r=function(t,n,o){t.target.classList.contains("card__like-button_is-active")?(function(t){fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers}).catch((function(e){return Promise.reject("Ошибка: ".concat(res.status))}))}(n),t.target.classList.remove("card__like-button_is-active"),o.textContent=parseInt(o.textContent)-1):(function(t){fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).catch((function(e){return Promise.reject("Ошибка: ".concat(res.status))}))}(n),t.target.classList.add("card__like-button_is-active"),o.textContent=parseInt(o.textContent)+1)};function c(e,t,o,r,c,a,u,i){var s=n.cloneNode(!0),d=s.querySelector(".card__delete-button"),l=s.querySelector(".card__image"),p=s.querySelector(".card__like-button"),f=s.querySelector(".card__likes-counter"),_=e.likes;return l.src=e.link,l.alt=e.name,f.textContent=e.likes.length,s.querySelector(".card__title").textContent=e.name,e.owner._id===i?d.addEventListener("click",(function(n){return t(n,e._id)})):d.style.display="none",_.find((function(e){return e._id===i}))?(p.classList.add("card__like-button_is-active"),p.addEventListener("click",(function(t){return o(t,e._id,f)}))):p.addEventListener("click",(function(t){return o(t,e._id,f)})),l.addEventListener("click",(function(){return u(r,c,a,e.link,e.name)})),s}function a(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",i)}function u(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",i)}function i(e){"Escape"===e.key&&u(document.querySelector(".popup_is-opened"))}function s(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove("popup__button_not-valid"),t.removeAttribute("disabled","")):(t.classList.add("popup__button_not-valid"),t.setAttribute("disabled",""))}var d,l=document.querySelector(".places__list"),p=document.querySelector(".profile__edit-button"),f=document.querySelector(".popup_type_edit"),_=document.querySelector(".popup_type_avatar"),m=document.querySelector(".profile__image"),v=document.querySelectorAll(".popup__close"),y=document.querySelector(".popup_type_new-card"),h=document.querySelector(".profile__add-button"),b=document.querySelector(".popup_type_image"),S=b.querySelector(".popup__image"),q=b.querySelector(".popup__caption"),k=document.querySelectorAll(".popup"),L=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),g=document.querySelector(".profile__image"),C=document.querySelector(".popup__input_type_name"),x=document.querySelector(".popup__input_type_description"),j=document.querySelector(".popup__input_type_avatar-url"),A=document.forms["edit-profile"],P=document.forms["new-place"],U=document.forms["update-avatar"];function w(e,t,n,o,r){t.src=o,t.alt=r,n.textContent=r,a(e)}y.querySelector(".popup__input_type_card-name"),m.addEventListener("click",(function(){a(_)})),p.addEventListener("click",(function(){var e,t,n;C.value=L.textContent,x.value=E.textContent,t=(e=f).querySelectorAll(".popup__error"),n=e.querySelectorAll(".popup__input"),t.forEach((function(e){e.textContent=""})),n.forEach((function(e){e.classList.remove("popup__input_not-valid")})),a(f)})),h.addEventListener("click",(function(){a(y)})),v.forEach((function(e){e.addEventListener("click",(function(e){u(e.target.closest(".popup"))}))})),k.forEach((function(e){e.addEventListener("click",(function(e){e.target.classList.contains("popup")&&u(e.target)}))})),U.addEventListener("submit",(function(n){n.preventDefault();var o=U.querySelector(".popup__button"),r=j.value;t(!0,o),function(t){return fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:t})}).then((function(e){if(e.ok)return e.json()})).catch((function(){return Promise.reject("Ошибка: ".concat(res.status))}))}(j.value).then((function(e){g.style="background-image: url('".concat(r,"')"),u(n.target.closest(".popup"))})).finally((function(){t(!1,o)}))})),A.addEventListener("submit",(function(n){n.preventDefault();var o,r,c=A.querySelector(".popup__button");t(!0,c),(o=C.value,r=x.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:o,about:r})}).then((function(e){if(e.ok)return e.json()})).catch((function(){return Promise.reject("Ошибка: ".concat(res.status))}))).then((function(e){L.textContent=e.name,E.textContent=e.about,u(n.target.closest(".popup"))})).finally((function(){t(!1,c)}))})),P.addEventListener("submit",(function(n){n.preventDefault();var a,i,s=P.querySelector(".popup__button");t(!0,s),(a=P.elements["place-name"].value,i=P.elements.link.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:a,link:i})}).then((function(e){if(e.ok)return e.json()})).catch((function(){return Promise.reject("Ошибка: ".concat(res.status))}))).then((function(e){var t=c(e,o,r,b,S,q,w,e.owner._id);l.prepend(t)})).finally((function(){P.reset(),u(n.target.closest(".popup")),t(!1,s)}))})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".button");s(t,n),t.forEach((function(o){o.addEventListener("input",(function(){var r=e.querySelector(".".concat(o.id,"-error"));o.validity.patternMismatch?(r.textContent="Разрешены только латинские и кириллические буквы, знаки дефиса и пробелы",o.classList.add("popup__input_not-valid")):o.validity.valid?(o.classList.remove("popup__input_not-valid"),r.textContent=""):(r.textContent=o.validationMessage,o.classList.add("popup__input_not-valid")),s(t,n)}))})),e.addEventListener("submit",(function(){s(t,n)}))}(e)})),fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){if(e.ok)return e.json()})).catch((function(){return Promise.reject("Ошибка: ".concat(res.status))})).then((function(e){return L.textContent=e.name,E.textContent=e.about,g.style="background-image: url('".concat(e.avatar,"')"),d=e._id})).then((function(){var t;return t=d,fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){if(e.ok)return e.json()})).catch((function(){return Promise.reject("Ошибка: ".concat(res.status))})).then((function(e){Array.from(e).forEach((function(e){var n=c(e,o,r,b,S,q,w,t);l.append(n)}))})),d}))})();
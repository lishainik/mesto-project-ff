(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-37",headers:{authorization:"834735c1-0023-486e-9cd7-15b9f35fd60d","Content-Type":"application/json"}},t=document.querySelector("#card-template").content,n=function(t,n){(function(t){return fetch("".concat(e.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e:Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))})(n).then((function(){t.target.closest(".card").remove()})).catch((function(e){console.log(e)}))},o=function(t,n,o){t.target.classList.contains("card__like-button_is-active")?function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e:Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e.json()})).catch((function(e){console.log(e)}))}(n).then((function(e){t.target.classList.remove("card__like-button_is-active"),o.textContent=e.likes.length})).catch((function(e){console.log(e)})):function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e:Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e.json()})).catch((function(e){console.log(e)}))}(n).then((function(e){t.target.classList.add("card__like-button_is-active"),o.textContent=e.likes.length})).catch((function(e){console.log(e)}))};function c(e,n,o,c,r){var a=t.cloneNode(!0),u=a.querySelector(".card__delete-button"),i=a.querySelector(".card__image"),s=a.querySelector(".card__like-button"),l=a.querySelector(".card__likes-counter"),d=e.likes;return i.src=e.link,i.alt=e.name,l.textContent=e.likes.length,a.querySelector(".card__title").textContent=e.name,e.owner._id===c?u.addEventListener("click",(function(t){return n(t,e._id)})):u.style.display="none",d.find((function(e){return e._id===c}))?(s.classList.add("card__like-button_is-active"),s.addEventListener("click",(function(t){return o(t,e._id,l)}))):s.addEventListener("click",(function(t){return o(t,e._id,l)})),i.addEventListener("click",(function(t){return r(e.link,e.name)})),a}function r(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",u)}function a(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",u)}function u(e){"Escape"===e.key&&a(document.querySelector(".popup_is-opened"))}function i(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.removeAttribute("disabled","")):(t.classList.add(n),t.setAttribute("disabled",""))}var s,l={formSelector:".popup__form",inputSelector:".popup__input",inactiveButtonClass:"popup__button_not-valid",submitButtonSelector:".popup__button",errorClass:"popup__input_not-valid",errorSelector:".popup__error"},d=document.querySelector(".places__list"),p=document.querySelector(".profile__edit-button"),f=document.querySelector(".popup_type_edit"),_=document.querySelector(".popup_type_avatar"),m=document.querySelector(".profile__image"),h=document.querySelectorAll(".popup__close"),v=document.querySelector(".popup_type_new-card"),y=document.querySelector(".profile__add-button"),S=document.querySelector(".popup_type_image"),b=S.querySelector(".popup__image"),g=S.querySelector(".popup__caption"),k=document.querySelectorAll(".popup"),q=document.querySelector(".profile__title"),L=document.querySelector(".profile__description"),E=document.querySelector(".profile__image"),C=document.querySelector(".popup__input_type_name"),j=document.querySelector(".popup__input_type_description"),x=document.querySelector(".popup__input_type_avatar-url"),A=document.forms["edit-profile"],P=document.forms["new-place"],U=document.forms["update-avatar"];function w(e,t){t.textContent=e?"Сохраняется...":"Cохранить"}function T(e,t){b.src=e,b.alt,g.textContent=t,r(S)}v.querySelector(".popup__input_type_card-name"),m.addEventListener("click",(function(){r(_)})),p.addEventListener("click",(function(){var e,t,n,o,c,a;C.value=q.textContent,j.value=L.textContent,t=l.inputSelector,n=l.errorSelector,o=l.errorClass,c=(e=f).querySelectorAll("".concat(n)),a=e.querySelectorAll("".concat(t)),c.forEach((function(e){e.textContent=""})),a.forEach((function(e){e.classList.remove(o)})),r(f)})),y.addEventListener("click",(function(){r(v)})),h.forEach((function(e){e.addEventListener("click",(function(e){a(e.target.closest(".popup"))}))})),k.forEach((function(e){e.addEventListener("click",(function(e){e.target.classList.contains("popup")&&a(e.target)}))})),U.addEventListener("submit",(function(t){t.preventDefault();var n=U.querySelector(".popup__button"),o=x.value;w(!0,n),function(t){return fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(x.value).then((function(e){E.style="background-image: url('".concat(o,"')"),a(t.target.closest(".popup"))})).finally((function(){w(!1,n)}))})),A.addEventListener("submit",(function(t){t.preventDefault();var n,o,c=A.querySelector(".popup__button");w(!0,c),(n=C.value,o=j.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){q.textContent=e.name,L.textContent=e.about,a(t.target.closest(".popup"))})).catch((function(e){console.log(e)})).finally((function(){w(!1,c)}))})),P.addEventListener("submit",(function(t){t.preventDefault();var r,u,i=P.querySelector(".popup__button");w(!0,i),(r=P.elements["place-name"].value,u=P.elements.link.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:r,link:u})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){var t=c(e,n,o,e.owner._id,T);d.prepend(t)})).then((function(){P.reset(),a(t.target.closest(".popup"))})).catch((function(e){console.log(e)})).finally((function(){w(!1,i)}))})),function(e){Array.from(document.querySelectorAll("".concat(e.formSelector))).forEach((function(t){!function(e,t,n,o,c){var r=Array.from(e.querySelectorAll("".concat(n))),a=e.querySelector("".concat(o));i(r,a,t),r.forEach((function(n){n.addEventListener("input",(function(){var o=e.querySelector(".".concat(n.id,"-error"));n.validity.patternMismatch?(o.textContent="Разрешены только латинские и кириллические буквы, знаки дефиса и пробелы",n.classList.add(c)):n.validity.valid?(n.classList.remove(c),o.textContent=""):(o.textContent=n.validationMessage,n.classList.add(c)),i(r,a,t)}))})),e.addEventListener("submit",(function(){i(r,a)}))}(t,e.inactiveButtonClass,e.inputSelector,e.submitButtonSelector,e.errorClass)}))}(l),fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return q.textContent=e.name,L.textContent=e.about,E.style="background-image: url('".concat(e.avatar,"')"),s=e._id})).then((function(){var t;return t=s,fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).then((function(e){Array.from(e).forEach((function(e){var r=c(e,n,o,t,T);d.append(r)}))})).catch((function(e){console.log(e)})),s})).catch((function(e){console.log(e)}))})();
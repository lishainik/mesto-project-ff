(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-37",headers:{authorization:"834735c1-0023-486e-9cd7-15b9f35fd60d","Content-Type":"application/json"}},t=document.querySelector("#card-template").content,n=function(t,n){!function(t){fetch("".concat(e.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e:Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(n),t.target.closest(".card").remove()},o=function(t,n,o){t.target.classList.contains("card__like-button_is-active")?function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e:Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(n).then((function(e){if(e.ok)return e.json()})).then((function(e){t.target.classList.remove("card__like-button_is-active"),o.textContent=e.likes.length})):function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e:Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(n).then((function(e){if(e.ok)return e.json()})).then((function(e){t.target.classList.add("card__like-button_is-active"),o.textContent=e.likes.length}))};function c(e,n,o,c,r){var a=t.cloneNode(!0),u=a.querySelector(".card__delete-button"),i=a.querySelector(".card__image"),s=a.querySelector(".card__like-button"),l=a.querySelector(".card__likes-counter"),d=e.likes;return i.src=e.link,i.alt=e.name,l.textContent=e.likes.length,a.querySelector(".card__title").textContent=e.name,e.owner._id===c?u.addEventListener("click",(function(t){return n(t,e._id)})):u.style.display="none",d.find((function(e){return e._id===c}))?(s.classList.add("card__like-button_is-active"),s.addEventListener("click",(function(t){return o(t,e._id,l)}))):s.addEventListener("click",(function(t){return o(t,e._id,l)})),a}function r(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",u)}function a(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",u)}function u(e){"Escape"===e.key&&a(document.querySelector(".popup_is-opened"))}function i(e,t){t.textContent=e?"Сохраняется...":"Cохранить"}function s(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.removeAttribute("disabled","")):(t.classList.add(n),t.setAttribute("disabled",""))}var l,d={formSelector:".popup__form",inputSelector:".popup__input",inactiveButtonClass:"popup__button_not-valid",submitButtonSelector:".popup__button",errorClass:"popup__input_not-valid",errorSelector:".popup__error"},p=document.querySelector(".places__list"),f=document.querySelector(".profile__edit-button"),_=document.querySelector(".popup_type_edit"),m=document.querySelector(".popup_type_avatar"),h=document.querySelector(".profile__image"),v=document.querySelectorAll(".popup__close"),y=document.querySelector(".popup_type_new-card"),S=document.querySelector(".profile__add-button"),b=document.querySelector(".popup_type_image"),g=b.querySelector(".popup__image"),k=b.querySelector(".popup__caption"),q=document.querySelectorAll(".popup"),L=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),C=document.querySelector(".profile__image"),j=document.querySelector(".popup__input_type_name"),x=document.querySelector(".popup__input_type_description"),A=document.querySelector(".popup__input_type_avatar-url"),P=document.forms["edit-profile"],U=document.forms["new-place"],w=document.forms["update-avatar"];y.querySelector(".popup__input_type_card-name"),console.log(b),p.addEventListener("click",(function(e){if(e.target.classList.contains("card__image")){var t=e.target.closest(".card").querySelector(".card__image");g.src=t.src,k.textContent=t.alt,r(b)}})),h.addEventListener("click",(function(){r(m)})),f.addEventListener("click",(function(){var e,t,n,o,c,a;j.value=L.textContent,x.value=E.textContent,t=d.inputSelector,n=d.errorSelector,o=d.errorClass,c=(e=_).querySelectorAll("".concat(n)),a=e.querySelectorAll("".concat(t)),c.forEach((function(e){e.textContent=""})),a.forEach((function(e){e.classList.remove(o)})),r(_)})),S.addEventListener("click",(function(){r(y)})),v.forEach((function(e){e.addEventListener("click",(function(e){a(e.target.closest(".popup"))}))})),q.forEach((function(e){e.addEventListener("click",(function(e){e.target.classList.contains("popup")&&a(e.target)}))})),w.addEventListener("submit",(function(t){t.preventDefault();var n=w.querySelector(".popup__button"),o=A.value;i(!0,n),function(t){return fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(A.value).then((function(e){C.style="background-image: url('".concat(o,"')"),a(t.target.closest(".popup"))})).finally((function(){i(!1,n)}))})),P.addEventListener("submit",(function(t){t.preventDefault();var n,o,c=P.querySelector(".popup__button");i(!0,c),(n=j.value,o=x.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){L.textContent=e.name,E.textContent=e.about,a(t.target.closest(".popup"))})).finally((function(){i(!1,c)}))})),U.addEventListener("submit",(function(t){t.preventDefault();var r,u,s=U.querySelector(".popup__button");i(!0,s),(r=U.elements["place-name"].value,u=U.elements.link.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:r,link:u})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){var t=c(e,n,o,e.owner._id);p.prepend(t)})).then((function(){U.reset(),a(t.target.closest(".popup")),i(!1,s)})).catch((function(e){console.log(e)}))})),function(e){Array.from(document.querySelectorAll("".concat(e.formSelector))).forEach((function(t){!function(e,t,n,o,c){var r=Array.from(e.querySelectorAll("".concat(n))),a=e.querySelector("".concat(o));s(r,a,t),r.forEach((function(n){n.addEventListener("input",(function(){var o=e.querySelector(".".concat(n.id,"-error"));n.validity.patternMismatch?(o.textContent="Разрешены только латинские и кириллические буквы, знаки дефиса и пробелы",n.classList.add(c)):n.validity.valid?(n.classList.remove(c),o.textContent=""):(o.textContent=n.validationMessage,n.classList.add(c)),s(r,a,t)}))})),e.addEventListener("submit",(function(){s(r,a)}))}(t,e.inactiveButtonClass,e.inputSelector,e.submitButtonSelector,e.errorClass)}))}(d),fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).then((function(e){return L.textContent=e.name,E.textContent=e.about,C.style="background-image: url('".concat(e.avatar,"')"),l=e._id})).then((function(){var t;return t=l,fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).then((function(e){Array.from(e).forEach((function(e){var r=c(e,n,o,t);p.append(r)}))})),l})).catch((function(e){console.log(e)}))})();